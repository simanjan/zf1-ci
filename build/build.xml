<?xml version="1.0" encoding="UTF-8"?>
<project name="zf1-ci" default="build">

	<target name="build" depends="prepare,zf,testing" />

	<target name="clean" description="Cleanup build artifacts">
		<delete dir="../library/Zend"/>
		<delete dir="../build/coverage"/>
		<delete dir="../build/logs"/>
		<delete dir="../build/tests"/>
	</target>

	<target name="prepare" depends="clean" description="Prepare for build">
		<mkdir dir="../library/Zend"/>
		<mkdir dir="../build/coverage"/>
		<mkdir dir="../build/logs"/>
		<mkdir dir="../build/tests"/>
	</target>

	<target name="zf" description="Creating symlink for Zend Framework">
		<exec passthru="true" executable="pwd"/>
		<!--<exec executable="cp -r /lib/ZendFramework-1.11.11/library/Zend /var/lib/jenkins/jobs/zf1-ci/workspace/library" escape="false" passthru="true" />-->
		<copy todir="../library/Zend">
			<fileset defaultexcludes="false" dir="/lib/ZendFramework-1.11.11/library/Zend">
				<include name="**/*.php" />
			</fileset>
		</copy>
	</target>

	<target name="testing" description="Run unit tests with PHPUnit">
		<!-- The CoverageSetupTask prepares a database which can be used to gather code coverage information for unit tests. -->
		<coverage-setup database="../build/coverage/coverage.db">
			<fileset dir="../application">
				<include name="**/*.php"/>
				<exclude name="**/*Test.php"/>
			</fileset>
		</coverage-setup>

		<!-- This task runs testcases using the PHPUnit framework. It is a functional port of the Ant JUnit task. -->
		<phpunit bootstrap="../tests/bootstrap.php" codecoverage="true" printsummary="true">
			<formatter type="xml" todir="../build/logs" outfile="junit.xml"/>
			<formatter type="clover" todir="../build/logs" outfile="clover.xml"/>
			<batchtest>
				<fileset dir="../tests">
					<include name="**/*Test.php"/>
				</fileset>
			</batchtest>
		</phpunit>
		<!--<phpunitreport infile="../build/coverage/testsuites.xml" format="frames" todir="../build/tests"/>-->
		<!--<coverage-report outfile="../build/coverage/coverage.xml">-->
			<!--<report toDir="../build/coverage" title="Demo"/>-->
		<!--</coverage-report>-->
	</target>

</project>
