<?xml version="1.0" encoding="UTF-8"?>
<project name="zf1-ci" default="build">

	<target name="build" depends="prepare,testing" />

	<target name="clean" description="Cleanup build artifacts">
		<delete dir="../build/coverage"/>
		<delete dir="../build/logs"/>
	</target>

	<target name="zf" description="Creating symlink for Zend Framework">
		<mkdir dir="../library"/>
		<exec executable="ln -s /lib/ZendFramework-1.11.11/library/Zend ../library/Zend" passthru="true" />
	</target>

	<target name="prepare" depends="clean,zf" description="Prepare for build">
		<mkdir dir="../build/coverage"/>
		<mkdir dir="../build/logs"/>
	</target>

	<target name="testing" description="Run unit tests with PHPUnit">
		<coverage-setup database="../build/coverage/coverage.db">
			<fileset dir="../application">
				<include name="**/*.php"/>
				<exclude name="**/*Test.php"/>
			</fileset>
		</coverage-setup>
		<phpunit codecoverage="true">
			<formatter type="xml" todir="../build/coverage"/>
			<batchtest>
				<fileset dir="../tests">
					<include name="**/*Test.php"/>
				</fileset>
			</batchtest>
		</phpunit>
		<phpunitreport infile="../build/coverage/testsuites.xml" format="frames" todir="reports/tests"/>
		<coverage-report outfile="../build/coverage/coverage.xml">
			<report toDir="../build/coverage" title="Demo"/>
		</coverage-report>
	</target>

</project>
