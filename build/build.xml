<?xml version="1.0" encoding="UTF-8"?>
<project name="zf1-ci" default="build">

	<target name="build" depends="prepare,testing" />

	<target name="clean" description="Cleanup build artifacts">
		<delete dir="${basedir}/build/coverage"/>
		<delete dir="${basedir}/build/logs"/>
	</target>

	<target name="prepare" depends="clean" description="Prepare for build">
		<mkdir dir="${basedir}/build/coverage"/>
		<mkdir dir="${basedir}/build/logs"/>
	</target>

	<target name="testing" description="Run unit tests with PHPUnit">
		<coverage-setup database="${basedir}/build/coverage/coverage.db">
			<fileset dir="../application">
				<include name="**/*.php"/>
				<exclude name="**/*Test.php"/>
			</fileset>
		</coverage-setup>
		<phpunit codecoverage="true">
			<formatter type="xml" todir="${basedir}/build/coverage"/>
			<batchtest>
				<fileset dir="src">
					<include name="**/*Test.php"/>
				</fileset>
			</batchtest>
		</phpunit>
		<phpunitreport infile="reports/testsuites.xml" format="frames" todir="reports/tests"/>
		<coverage-report outfile="reports/coverage.xml">
			<report toDir="reports/coverage" title="Demo"/>
		</coverage-report>
	</target>

</project>
